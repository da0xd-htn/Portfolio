<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Three.js GLTF Universal Loader</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
    }

    canvas {
      display: block;
    }
  </style>
  <script type="importmap">
  {
    "imports": {
      "three": "https://cdn.jsdelivr.net/npm/three@0.165/build/three.module.js",
      "three/addons/": "https://cdn.jsdelivr.net/npm/three@0.165/examples/jsm/"
    }
  }
  </script>
</head>

<body>

  <script type="module">
    import * as THREE from "three";
    import { OrbitControls } from "three/addons/controls/OrbitControls.js";
    import { GLTFLoader } from "three/addons/loaders/GLTFLoader.js";

    // --- SCENE ---
    const scene = new THREE.Scene();
    scene.background = new THREE.Color(0x111111);

    // --- CAMERA ---
    const camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      0.1,
      1000
    );
    camera.position.set(0, 5, 15);

    // --- RENDERER ---
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    document.body.appendChild(renderer.domElement);

    // --- CONTROLS ---
    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;

    // --- LIGHTS ---
    const dirLight = new THREE.DirectionalLight(0xffffff, 2);
    dirLight.position.set(10, 20, 10);
    dirLight.castShadow = true;
    scene.add(dirLight);

    const ambient = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambient);

    // --- FLOOR (Optional, only if you need a ground plane) ---
    const floorGeo = new THREE.PlaneGeometry(200, 200);
    const floorMat = new THREE.MeshStandardMaterial({ color: 0x222222 });
    const floor = new THREE.Mesh(floorGeo, floorMat);
    floor.rotation.x = -Math.PI / 2;
    floor.receiveShadow = true;
    scene.add(floor);

    // --- VARIABLES ---s
    let mixer;
    const clock = new THREE.Clock();

    // --- LOAD GLTF/GLB SCENE ---
    // Change this path to your scene file
    const SCENE_FILE = 'blender-3.5-splash.glb';

    const loader = new GLTFLoader();
    loader.load(
      SCENE_FILE,
      (gltf) => {
        const loadedScene = gltf.scene;

        // Apply shadows to all meshes
        loadedScene.traverse((obj) => {
          if (obj.isMesh) {
            obj.castShadow = true;
            obj.receiveShadow = true;
          }
        });

        scene.add(loadedScene);

        // Handle animations (if any)
        if (gltf.animations.length > 0) {
          mixer = new THREE.AnimationMixer(loadedScene);
          gltf.animations.forEach((clip) => {
            mixer.clipAction(clip).play();
          });
        }

        animate();
      },
      undefined,
      (err) => console.error('Error loading GLTF:', err)
    );

    // --- ANIMATION LOOP ---
    function animate() {
      requestAnimationFrame(animate);

      const delta = clock.getDelta();
      if (mixer) mixer.update(delta);

      controls.update();
      renderer.render(scene, camera);
    }

    // --- RESPONSIVE ---
    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });

  </script>
</body>

</html>
